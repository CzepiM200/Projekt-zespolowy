(this["webpackJsonpreact-app"]=this["webpackJsonpreact-app"]||[]).push([[0],{195:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(70),s=a.n(o),c=(a(81),a(3)),l=a(4),i=a(5),u=a(6),m=a(30),h=a(14),d=(a(82),a(18)),p=a.n(d),g=a(29),b=a(8),f=a(17),v=a.n(f),E="https://system-liczenia-frekwencji.herokuapp.com/auth/",C=v.a.create({baseURL:E,timeout:5e3,headers:{Authorization:localStorage.getItem("access_token")?"JWT "+localStorage.getItem("access_token"):null,"Content-Type":"application/json",accept:"application/json"}});C.interceptors.response.use((function(e){return e}),(function(e){var t=e.config;if(401===e.response.status&&t.url===E+"token/refresh/")return window.location.href="/login/",Promise.reject(e);if("token_not_valid"===e.response.data.code&&401===e.response.status&&"Unauthorized"===e.response.statusText){var a=localStorage.getItem("refresh_token");if(a){var n=JSON.parse(atob(a.split(".")[1])),r=Math.ceil(Date.now()/1e3);if(console.log(n.exp),n.exp>r)return C.post("/token/refresh/",{refresh:a}).then((function(e){return localStorage.setItem("access_token",e.data.access),localStorage.setItem("refresh_token",e.data.refresh),C.defaults.headers.Authorization="JWT "+e.data.access,t.headers.Authorization="JWT "+e.data.access,C(t)})).catch((function(e){console.log(e)}));console.log("Refresh token is expired",n.exp,r),window.location.href="/login/"}else console.log("Refresh token not available."),window.location.href="/login/"}return Promise.reject(e)}));var y=C,k=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){var e;return Object(c.a)(this,a),(e=t.call(this)).handleLogout=e.handleLogout.bind(Object(b.a)(e)),e}return Object(l.a)(a,[{key:"handleLogout",value:function(){var e=Object(g.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.onLogOut();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-dark bg-dark"},r.a.createElement("a",{className:"navbar-brand",href:"/"},"System liczenia frekwencji"),r.a.createElement("button",{className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},r.a.createElement("span",{className:"navbar-toggler-icon"})),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarNav"},r.a.createElement("ul",{className:"navbar-nav"},r.a.createElement("li",{className:"nav-item"},r.a.createElement(m.b,{to:"./login"},"Logowanie")),r.a.createElement("button",{onClick:this.handleLogout},"Logout"))))}}]),a}(n.Component),S=a(73),w=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={type:n.props.selectedChart,data:{labels:e.labels,datasets:[{label:"Liczba os\xf3b",fill:!0,backgroundColor:"rgba(220,20,60,0.4)",borderColor:"rgba(220,20,60,1)",borderDashOffset:0,pointBackgroundColor:"#fff",pointHoverRadius:5,pointHoverBackgroundColor:"rgba(75,192,192,1)",pointHoverBorderColor:"#000",pointHoverBorderWidth:2,pointRadius:4,pointHitRadius:5,data:e.numbers}]},options:{scales:{yAxes:[{display:!0,ticks:{beginAtZero:!0,suggestedMax:100}}]},responsive:!0}},n}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(S.a,{data:this.state.data,options:this.state.options,redraw:!0}))}}]),a}(n.Component),j=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleChange=function(e){n.setState({selectedChart:e.target.value,typeOfChart:e.target.id})},n.handleSubmit=function(){n.props.selectChart(n.state.typeOfChart),n.setState({activeChart:n.state.selectedChart})},n.state={selectedChart:null,typeOfChart:"today",activeChart:"dzisiaj"},n}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"list-group"},r.a.createElement("div",{className:"card text-white bg-primary mb-3"},r.a.createElement("div",{className:"card-header"},"Statystyki z ",this.state.activeChart)),r.a.createElement("button",{id:"today",value:"dzisiaj",onClick:this.handleSubmit,onMouseEnter:this.handleChange,className:"list-group-item list-group-item-action"},"Statystyki z dzisiaj"),r.a.createElement("button",{id:"yesterday",value:"wczoraj",onClick:this.handleSubmit,onMouseEnter:this.handleChange,className:"list-group-item list-group-item-action"},"Statystyki z wczoraj"),r.a.createElement("button",{id:"week",value:"tygodnia",onClick:this.handleSubmit,onMouseEnter:this.handleChange,className:"list-group-item list-group-item-action"},"Statystyki z tygodnia"),r.a.createElement("button",{id:"month",value:"miesi\u0105ca",onClick:this.handleSubmit,onMouseEnter:this.handleChange,className:"list-group-item list-group-item-action"},"Statystyki z miesi\u0105ca"),r.a.createElement("button",{id:"year",value:"roku",onClick:this.handleSubmit,onMouseEnter:this.handleChange,className:"list-group-item list-group-item-action"},"Statystyki z roku"),r.a.createElement("button",{id:"all",value:"ca\u0142ego okresu",onClick:this.handleSubmit,onMouseEnter:this.handleChange,className:"list-group-item list-group-item-action"},"Statystyki z ca\u0142ego okresu"),r.a.createElement("button",{id:"unstandardized",value:"okersu niestandardowego",onClick:this.handleSubmit,onMouseEnter:this.handleChange,className:"list-group-item list-group-item-action"},"Statystyki z okresu niestandardowego"))}}]),a}(n.Component),O=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleDateChange=function(e){n.setState({selectedChart:e})},n.setDateChange=function(){n.props.onDateChange("date1","date2")},n.state={firstDate:null,secondDate:null},n}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-6 input-group"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("label",{className:"input-group-text",htmlFor:"inputGroupSelect01"},"Do:")),r.a.createElement("input",{type:"date"})),r.a.createElement("div",{className:"col-6 input-group"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("label",{className:"input-group-text",htmlFor:"inputGroupSelect02"},"Do:")),r.a.createElement("input",{type:"date"})))}}]),a}(n.Component),N=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).onChartSelect=function(e){n.setState({selectedChart:e});Object(b.a)(n);var t=new Date,a=new Date,r=new Date;"today"===n.state.selectedChart&&(a=new Date(t.getFullYear(),t.getMonth(),t.getDay()),r=new Date(t.getFullYear(),t.getMonth(),t.getDay()+1)),console.log(a.toISOString()),console.log(r.toISOString());var o="https://system-liczenia-frekwencji.herokuapp.com/api/entrances/["+a.toISOString()+"]["+r.toISOString()+"]";v.a.get(o,{headers:{Authorization:"JWT "+localStorage.getItem("access_token")}}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},n.onDateChange=function(e,t){},n.state={selectedChart:"today",earlyDate:0,lateDate:0},n.onChartSelect=n.onChartSelect.bind(Object(b.a)(n)),n}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row justify-content-around"},r.a.createElement("div",{className:"col-3"},r.a.createElement(j,{chartType:this.state.chartType,selectChart:this.onChartSelect})),r.a.createElement("div",{className:"col-8"},r.a.createElement("div",{className:"row"},r.a.createElement(O,null)),r.a.createElement("br",null),r.a.createElement(w,{labels:this.props.labels,numbers:this.props.numbers,selectedChart:this.props.selectedChart,onDateChange:this.onDateChange}))))}}]),a}(n.Component),z=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={connectionCharacter:" ",camera1Character:" ",routerConnectionCharacter:" ",isWorking:!1},n.checkSystem=n.checkSystem.bind(Object(b.a)(n)),n}return Object(l.a)(a,[{key:"setInfo",value:function(e){return"s"==e?r.a.createElement("div",null,r.a.createElement("span",{className:"badge badge-success badge-pill"},"Dzia\u0142a poprawnie")):"w"==e?r.a.createElement("span",{className:"badge badge-warning badge-pill"},"W trakcie sprawdzania"):"d"==e?r.a.createElement("span",{className:"badge badge-danger badge-pill"},"Wyst\u0105pi\u0142 b\u0142\u0105d"):r.a.createElement("span",{className:"badge badge-warning badge-pill"},"..")}},{key:"checkSystem",value:function(){this.setState({connectionCharacter:"w",camera1Character:"w",routerConnectionCharacter:"w"});var e=this;v.a.get("https://system-liczenia-frekwencji.herokuapp.com/api/service/connectivity",{headers:{Authorization:"JWT "+localStorage.getItem("access_token")}}).then((function(t){t.data.isWorking?e.setState({connectionCharacter:"s",camera1Character:"s",routerConnectionCharacter:"s"}):e.setState({connectionCharacter:"s",camera1Character:"d",routerConnectionCharacter:"s"}),console.log(this.state.routerConnectionCharacter)})).catch((function(e){})),"s"!=this.state.connectionCharacter&&e.setState({connectionCharacter:"d",camera1Character:"d",routerConnectionCharacter:"d"})}},{key:"render",value:function(){return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"col-12"},r.a.createElement("ul",{className:"list-group"},r.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center"},r.a.createElement("h4",null,"Diagnostyka systemu"),r.a.createElement("button",{onClick:this.checkSystem,type:"button",className:"btn btn-info"},"Rozpocznij test")),r.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center"},"Po\u0142\u0105czenie z serwerem",this.setInfo(this.state.connectionCharacter)),r.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center"},"Po\u0142\u0105czenie z routerem",this.setInfo(this.state.routerConnectionCharacter)),r.a.createElement("li",{className:"list-group-item d-flex justify-content-between align-items-center"},"Po\u0142\u0105czenie serwera z kamer\u0105 [nazwa kamery 1]",this.setInfo(this.state.camera1Character)))))}}]),a}(n.Component),D=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleChangeFrom=function(e){n.setState({from:e.target.value})},n.handleChangeTo=function(e){n.setState({from:e.target.value})},n.handleSubmit=function(){},n.state={from:"00:00",to:"00:00",number:"0"},n}return Object(l.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"container-md"},r.a.createElement("div",{className:"row justify-content-around"},r.a.createElement("div",{className:"col-12 input-group justify-content-center"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("label",{className:"input-group-text",htmlFor:"inputGroupSelect02"},"Od:")),r.a.createElement("input",{type:"time",onChange:this.handleChangeFrom})),r.a.createElement("div",{className:"col-12 input-group justify-content-center"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("label",{className:"input-group-text",htmlFor:"inputGroupSelect02"},"Do:")),r.a.createElement("input",{type:"time",onChange:this.handleChangeTo}))),r.a.createElement("br",null),r.a.createElement("div",{className:"row justify-content-around"},r.a.createElement("button",{type:"button",class:"btn btn-primary",onSubmit:this.handleSubmit},"Sprawd\u017a")),r.a.createElement("hr",null),r.a.createElement("div",{className:"row justify-content-around"},r.a.createElement("div",{className:"alert alert-dismissible alert-info"},r.a.createElement("strong",null,"Liczba os\xf3b wykrytych przez kamer\u0119:"),r.a.createElement("br",null),r.a.createElement("h3",null,this.state.number))),r.a.createElement("hr",null))}}]),a}(n.Component),I=a(75),x=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={email:"",password:""},n.handleChange=n.handleChange.bind(Object(b.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(b.a)(n)),n.handleSubmitWThen=n.handleSubmitWThen.bind(Object(b.a)(n)),n}return Object(l.a)(a,[{key:"handleChange",value:function(e){this.setState(Object(I.a)({},e.target.name,e.target.value))}},{key:"handleSubmitWThen",value:function(e){e.preventDefault(),y.post("/token/obtain/",{email:this.state.email,password:this.state.password}).then((function(e){y.defaults.headers.Authorization="JWT "+e.data.access,localStorage.setItem("access_token",e.data.access),localStorage.setItem("refresh_token",e.data.refresh)})).catch((function(e){throw e}))}},{key:"handleSubmit",value:function(){var e=Object(g.a)(p.a.mark((function e(t){var a,n,r,o,s,c,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,y.post("/token/obtain/",{email:this.state.email,password:this.state.password});case 4:return a=e.sent,y.defaults.headers.Authorization="JWT "+a.data.access,localStorage.setItem("access_token",a.data.access),localStorage.setItem("refresh_token",a.data.refresh),n=localStorage.getItem("access_token"),r=n.split(".")[1],o=window.atob(r),s=JSON.parse(o),c=s.user_email,l=c.split("@")[0],localStorage.setItem("role",l),this.props.onLogIn(!0,l),e.abrupt("return",a);case 19:throw e.prev=19,e.t0=e.catch(1),e.t0;case 22:case"end":return e.stop()}}),e,this,[[1,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h3",null,"Strona w trakcie wystawiania, w razie problem\xf3w prosimy spr\xf3bowa\u0107 p\xf3\u017aniej... (3.5)"),"Login",r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("label",null,"Email:",r.a.createElement("input",{name:"email",type:"text",value:this.state.email,onChange:this.handleChange})),r.a.createElement("label",null,"Password:",r.a.createElement("input",{name:"password",type:"password",value:this.state.password,onChange:this.handleChange})),r.a.createElement("input",{type:"submit",value:"Submit"})))}}]),a}(n.Component),L=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).onLogIn=function(e,t){e?(n.setState({logIn:e,role:t}),n.forceUpdate()):n.setState({logIn:e,role:t})},n.onLogOut=function(){n.setState({logIn:!1,role:"non"})},n.state={logIn:!1,role:"non"},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(m.a,null,r.a.createElement(k,{onLogOut:this.onLogOut}),r.a.createElement("div",{className:"row justify-content-around"},r.a.createElement(h.c,null,r.a.createElement(h.a,{render:function(t){t.match;return e.state.logIn?"analityk"==e.state.role?r.a.createElement(N,{labels:["Dzie\u0144 1","Dzie\u0144 2","Dzie\u0144 3","Dzie\u0144 4","Dzie\u0144 5","Dzie\u0144 6","Dzie\u0144 7"],numbers:[35,48,60,54,56,83,42],type:"D"}):"technik"==e.state.role?r.a.createElement(z,null):"portier"==e.state.role?r.a.createElement(D,null):void 0:r.a.createElement(x,{onLogIn:e.onLogIn})}})))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(L,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},76:function(e,t,a){e.exports=a(195)},81:function(e,t,a){},82:function(e,t,a){}},[[76,1,2]]]);
//# sourceMappingURL=main.d8b57354.chunk.js.map